<%@ page import="requiredjava.DBConnection, java.sql.ResultSet" %>
<%
	if(request.getMethod().equalsIgnoreCase("POST")){
		
		String str = request.getParameter("query");
		String query = null;
		
		if(str.equals("overall"))
			query = "select FileName, Datetime, Count, Type, OutputLink from attack_report";

		else if(str.equals("yearly"))
			query = "select FileName, Datetime, Count, Type, OutputLink from attack_report where Year(Datetime)='"+request.getParameter("year")+"'";
		
		else if(str.equals("MonthYear"))
			query = "select FileName, Datetime, Count, Type, OutputLink from attack_report where Year(Datetime)='"+request.getParameter("year")+"' and Month(Datetime)="+request.getParameter("month");
		
		DBConnection.Init();
		
		ResultSet rs = DBConnection.executeQuery(query);
		
		String result="<TABLE BORDER='1' class='table table-hover table-bordered table-responsive '>" +
						"<TR style='background: #FDE3A7; color:black;'>" +
						"<TH>IP Address</TH><TH>DateTime</TH><TH>Count</TH><TH>Type</TH><TH>Link</TH>" +
						"</TR>";
		
		while(rs.next())
			result += "<tr><td>"+rs.getString(1)+"</td>" +
						"<td>"+rs.getString(2)+"</td>" +
						"<td>"+rs.getString(3)+"</td>" +
						"<td>"+rs.getString(4)+"</td>" +
						"<td><a class='fileLink' href='javascript:void(0);' title='"+rs.getString(5)+"'>Click here</a></td>";
		DBConnection.destroy();
		
		result += "</TABLE>";
		result += "<script>"+
				"$('.fileLink').click(function(){"+
					"window.open('getContentsOfAttackFile.jsp?path='+$(this).attr('title').trim(),'_blank');"+
				"});"+
			"</script>";
		out.print(result);
	}
	else
		response.sendRedirect("../");
%>