<%@ page import="requiredjava.DBConnection, java.sql.ResultSet" %>
<%
	if(request.getMethod().equalsIgnoreCase("POST") && request.getParameter("query").equalsIgnoreCase("overall")){
		
		
		int k;
		ResultSet rs;
		String result = "", count;
		
		// initialize database
		DBConnection.Init();
		
		rs=DBConnection.executeQuery("select Distinct Type from attack_report order by Type");
		
		rs.last();
		String []types = new String[rs.getRow()];
		rs.beforeFirst();
		
		k = 0;
		while(rs.next())
		{
			types[k++] = rs.getString(1);
		}
		rs.close();
		
		rs = DBConnection.executeQuery("select Distinct Year(Datetime) from attack_report order by Year(Datetime)");
		rs.last();
		String []years = new String[rs.getRow()];
		rs.beforeFirst();
		k=0;
		while (rs.next()) {
			years[k++] = rs.getString(1);
		}
		
		
		for(int i=0; i<years.length; ++i)
			for(int j=0; j<types.length; ++j){
				rs = DBConnection.executeQuery("select sum(Count) from attack_report where Year(Datetime)='"+years[i]+"' and Type='"+types[j]+"'");
				if(rs.next()){
					count = rs.getString(1);
					if(count == null)
						result += "0:";
					else
						result += count+":";
				}
			}
		
		// destroy database
		DBConnection.destroy();
		
		String finalResult = "";
		
		for(int i=0; i<years.length; ++i)
			finalResult += years[i]+":";
		finalResult += "&&";
		for(int i=0; i<types.length; ++i)
			finalResult += types[i]+":";
		finalResult += "&&";
		finalResult += result;
		
		out.print(finalResult);
	}
	else
		response.sendRedirect("../");
%>